---
title: "Template"
format: html
editor: visual
---

## Idea

The [sihouette score](https://en.wikipedia.org/wiki/Silhouette_(clustering)) is not guaranteed to shrink with larger $k$, although in my experience it usually does.

Let's see what happens in cross-validation.

## Metric Calculation

`silhouette` function is provided by `tidyclust`

## Experiments

```{r}
library(tidymodels)
library(tidyclust)
library(palmerpenguins)
```

```{r}
set.seed(1989)

penguins <- penguins |>
  drop_na()

km_spec <- k_means(num_clusters = tune())
rec <- recipe(~., data = penguins) |>
  step_dummy(all_nominal_predictors()) |>
  step_naomit(all_predictors())

wflow <- workflow() |>
  add_model(km_spec) |>
  add_recipe(rec)

cvs <- vfold_cv(penguins)

clust_num_grid <- grid_regular(num_clusters(),
  levels = 10
)

tune_res <- tune_cluster(
  wflow,
  resamples = cvs,
  grid = clust_num_grid,
  metrics = cluster_metric_set(silhouette_avg)
)

```

```{r}
tune_res |> 
  collect_metrics() |>
  ggplot() +
  aes(x = num_clusters, 
      y = mean) +
  geom_point() +
  geom_errorbar(aes(ymin = mean - std_err,
                ymax = mean + std_err),
                color = "grey") +
  theme_minimal()
```




## Results

Welp.  Nothing much here that is different from without cross-validation.  We pretty much see the silhouette score decrease as $k$ increases.
